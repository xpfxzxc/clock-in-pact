# CLAUDE.md

参考 [AGENTS.md](AGENTS.md) 了解项目概述、架构和开发规范。

## 分工原则

Nuxt 是全栈框架，前后端紧密集成。分工策略：

- **简单 CRUD** - Claude 全栈处理，避免协调开销
- **复杂后端逻辑** - 委托给 Codex（后端能力更强）

## 工作流

```
用户需求
    │
    ▼
┌─────────────────────────────────────────────────┐
│              Phase 1: Claude 准备               │
│  - 需求分析与拆解                               │
│  - Prisma schema 设计                           │
│  - API 类型定义（server/types/）                │
│  - 前端开发（pages、components、composables）   │
└─────────────────────────────────────────────────┘
    │
    │ 按功能模块委托（非单个接口）
    │ 提供：schema + 类型定义 + 业务需求
    ▼
┌─────────────────────────────────────────────────┐
│              Phase 2: Codex 实现                │
│  - server/api/ 路由实现                         │
│  - server/services/ 业务逻辑                    │
│  - tests/services/ 单元测试（同时交付）         │
└─────────────────────────────────────────────────┘
    │
    │ 执行结果反馈
    ▼
┌─────────────────────────────────────────────────┐
│              Phase 3: Claude 验收               │
│  - 审查 Codex 产出                              │
│  - 集成测试验证                                 │
│  - 问题修复与迭代                               │
│  - Git 提交与版本管理                           │
└─────────────────────────────────────────────────┘
```

## 委托规范

### 委托前准备

1. **设计 Prisma schema** - 数据模型涉及业务理解，由 Claude 完成
2. **定义 API 类型** - 在 `server/types/` 写好请求/响应类型，作为接口契约
3. **整理业务需求** - 明确功能边界和验收标准

### 委托内容

使用 `codex-delegator` skill，按功能模块整体委托：

```
✓ "实现打卡模块的所有 API（含测试）"
✗ "实现 POST /api/checkin 接口"  ← 粒度太细，协调成本高
```

委托时提供：
- 相关的 Prisma schema
- API 类型定义文件路径
- 业务规则和边界条件

### 验收标准

- 类型与契约一致
- 测试覆盖核心逻辑
- 错误处理符合规范
